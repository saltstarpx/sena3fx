# Claude Code 指示書 v11: 「バックテスト vs 現実」— 実績データとの照合

## 1. リポジトリ整理の完了承認と最重要発見の確認

ブランチ`claude/add-trading-backtest-ePJat`の最新状態を確認しました。素晴らしい整理です。特に、これまで埋もれていた**2,642件の実際のCFD取引履歴**（`trade_logs/broker_history_*.csv`）をUTF-8に変換し、リポジトリに統合してくれたことは、このプロジェクトにとって最大のブレークスルーです。

私の方でこの実データを分析したところ、驚くべき結果が出ています。

| 項目 | 結果 |
|:---|:---|
| **CFD決済件数** | 1,369件 |
| **実現損益合計** | **+17,585,449円** |
| **勝率（WR）** | **70.6%** |
| **金スポット損益** | +11,955,646円（770トレード） |
| **銀スポット損益** | +5,179,127円（507トレード） |

この実績は、我々がこれまでバックテストで追求してきた方向性が**根本的に正しい**ことを証明しています。今後は、この「実績」を絶対的な正解データ（Ground Truth）として、バックテストの精度をさらに高めていきます。

## 2. v11のテーマ：「Reality Check（現実との照合）」

v11の目的は、我々が構築したバックテスト戦略（Union, Yagami, Maedai）が、この輝かしい実績をどの程度説明できるのかを検証することです。バックテストと現実の乖離を特定し、その差を埋めることができれば、我々の戦略は「本物」になります。

## 3. v11タスク指示

### Task 1: [Teammate C] 2026年1月のドローダウンを分析せよ

- **背景:** 実績データでは、2026年1月に**-1,128,362円**という大きな損失月がありました。これは絶好のストレステスト材料です。我々の最強戦略であるUnion戦略は、この「負け相場」を予測できていたのでしょうか？
- **目的:** Union戦略が現実のドローダウンをどの程度再現できるかを検証する。
- **アクション:**
    1.  `data/ohlc/`にあるXAUUSDとXAGUSDの価格データから、**2026年1月分のみ**を抽出してください。
    2.  この1ヶ月分のデータに対して、`strategies/union_strategy.py`のバックテストを実行してください。
    3.  結果（PF, MDD, WR, 損益）を報告してください。もしUnion戦略もマイナス収支になれば、我々の戦略が現実の相場変動を正しく捉えられている証拠になります。

### Task 2: [Teammate B] 実績トレードと戦略シグナルを照合せよ

- **背景:** 我々の最終目標は、この実績を生み出した「トレーダーの思考」を戦略としてコード化することです。その第一歩として、実績トレードと戦略のシグナルがどれだけ一致するかを確認します。
- **目的:** バックテストで最も輝かしい成績を収めたUnion戦略が、現実の勝ちトレードをどの程度再現できているかを確認する。
- **アクション:**
    1.  実績データの中で最も利益が大きかった**2025年12月**の「金スポット」と「銀スポット」の決済トレードを`trade_logs/`から全て抽出してください。
    2.  `strategies/union_strategy.py`を2025年12月の価格データでバックテストし、生成されたシグナル（エントリー/エグジット）のリストを取得してください。
    3.  **「実績の勝ちトレード日時」と「Union戦略の買いシグナル日時」を比較**し、どの程度の日時が近接しているか（例: 24時間以内など）を分析し、考察を報告してください。完全に一致しなくても構いません。傾向が見えることが重要です。

### Task 3: [全員] 戦略ダッシュボードに「現実」を追加せよ

- **背景:** v10で構築を指示した`dashboard.html`は、バックテストの進化を追うためのものです。これに「現実」のパフォーマンスを追加することで、バックテストと現実の差が一目で分かるようになります。
- **目的:** 戦略ダッシュボードを、バックテストと現実を比較分析するための中心的なツールへと進化させる。
- **アクション:**
    1.  v10のTask 3（ダッシュボード構築）をまだ実行していない場合は、まずそちらを完了させてください。
    2.  `dashboard.html`に新しいセクション「**Real World Performance**」を追加してください。
    3.  `trade_logs/broker_history_*.csv`から月次の実現損益を計算し、その推移をダッシュボードに折れ線グラフで表示してください。（y軸: 累計損益, x軸: 年月）
    4.  これにより、バックテストの資産曲線と、現実の資産曲線を同じ画面で比較できるようになります。

## 4. GitHubへのログ記録

これらの変更が完了したら、`MANUS_CHANGELOG.md`に以下の要点を記録し、すべての変更を`claude/add-trading-backtest-ePJat`ブランチにプッシュしてください。

- **変更種別:** 現実データとの照合（Reality Check）
- **変更内容:**
    - 2026年1月のドローダウンをUnion戦略でバックテストし、再現性を検証。
    - 2025年12月の実績勝ちトレードとUnion戦略のシグナルを照合。
    - `dashboard.html`に現実の月次損益グラフを追加。
- **指示書:** `prompt_for_claude_code_v11.md`
