# Teammate C: Risk Manager — 市場環境フィルター

## 概要

個別エントリーシグナルではなく、ポートフォリオ全体のリスクを調整する
市場環境フィルターを開発・評価する。

**評価基準**: MDD低減率, ボラティリティ低減率, Sharpe Ratio改善率

## フィルター一覧

### 1. USD 強弱フィルター (新規)

**ファイル**: `strategies/market_filters.py`

- XAUUSD の逆モメンタムから USD 強弱をプロキシ算出
- `calc_usd_strength(bars, lookback=20, rank_window=100)` → 0-100
- USD ≥ 75 (上位25%) → ロングエントリー回避
- `make_usd_filtered_signal()` で既存シグナルにラップ適用

**Task 1 バックテスト結果**:
- 平均PF: 素 1.790 → +USD 1.881 (+0.091)
- 平均DD: 素 29.7% → +USD 27.5% (-2.3%)
- 平均Sharpe: 素 1.164 → +USD 1.212 (+0.048)

### 2. 季節フィルター

**実装**: `BacktestEngine.run(allowed_months=...)`

| プリセット | 月 | 用途 |
|---|---|---|
| `SEASON_ALL` | 全月 | ベースライン |
| `SEASON_SKIP_JUL_SEP` | 7月+9月除外 | Task 2 検証 |
| `SEASON_ACTIVE` | 1-3, 10-12月 | 冬季+秋季のみ |

**Task 2 結果**: YagamiFull_1H で 7+9月除外 → DD 40.2% → 29.9% (-10.3%), Sharpe 1.545 → 1.581

### 3. ボラティリティレジーム

**ファイル**: `lib/filters.py`

- ATR(14) / MA(ATR, 50) で正規化
- 0.6 未満: 静かすぎ → スキップ
- 2.2 超: 荒れすぎ → スキップ

### 4. トレンドレジーム

- EMA(50/200) の傾き + クロスで判定
- +1: ロング優勢 / -1: ショート優勢 / 0: 中立

### 5. 時刻アノマリー

- プライム時間帯: UTC 6-9h (ロンドン), 13-15h (NY)
- 回避時間帯: UTC 1-4h, 22-23h (アジア深夜)

### 6. 複合スコア

`composite_filter_score()` → 0-5 のスコア (ボラ+トレンド+モメンタム+時刻)

## 通貨強弱分析の結論

Manus AI の分析により「通貨強弱による動的ペア切替は XAGUSD 固定に勝てない」
→ ペア切替は不採用。USD 強弱はフィルターとしてのみ活用。
